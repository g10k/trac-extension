{% load djtrac_tags %}

{% if group_by_components or group_by_milestone %}
    <div class="panel-collapse collapse" id="milestone_{{ forloop.parentloop.counter }}_{{ forloop.counter }}" >
{% endif %}

<div class="bs-table" >
      <table class="table table-condensed table-bordered" >

          <thead>
            <tr>
              <th>#</th>
              <th>{{ sort_params.id.icon|safe }}<a href="{{ sort_params.id.url }}">№</a></th>
              <th>{{ sort_params.summary.icon|safe }}<a href="{{ sort_params.summary.url }}">Название</a></th>
              <th style="min-width: 85px;">{{ sort_params.time.icon|safe }}
                  <a href="{{ sort_params.time.url }}">Создан</a>
              </th>
              <th style="min-width: 85px;">{{ sort_params.changetime.icon|safe }}
                  <a href="{{ sort_params.changetime.url }}" >Изменен</a>
              </th>
              <th>{{ sort_params.priority.icon|safe }}<a href="{{ sort_params.priority.url }}" >Приоритет</a></th>
              <th>{{ sort_params.owner.icon|safe }}<a href="{{ sort_params.owner.url }}">Исполнитель</a></th>
              <th>{{ sort_params.milestone.icon|safe }}<a href="{{ sort_params.milestone.url }}">Этап</a></th>
              <th>{{ sort_params.status.icon|safe }}<a href="{{ sort_params.status.url }}">Состояние</a></th>
              <th>{{ sort_params.keywords.icon|safe }}<a href="{{ sort_params.keywords.url }}">Ключевые слова</a></th>
            </tr>
          </thead>
          <tbody>

            {% for ticket in tickets %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>
                        <a href="{{ ticket.id|djtrac_ticket_url }}">
                        {% if ticket.status == 'closed' %}
                            <s>{{ ticket.id }}</s>
                        {% else %}
                            {{ ticket.id }}
                        {% endif %}
                        </a>
                    </td>
                    <td>{{ ticket.summary }}</td>
                    <td title="{{ ticket.time|to_datetime}}">{{ ticket.time|to_datetime|date:'Y-m-d' }}</td>
                    <td title="{{ ticket.changetime|to_datetime }}">{{ ticket.changetime|to_datetime|date:'Y-m-d' }}</td>
                    <td>
                        <span class="label
                            {% if ticket.priority == 'низкий' %}label-info{% endif %}
                            {% if ticket.priority == 'нормальный' %}label-primary{% endif %}
                            {% if ticket.priority == 'высокий' %}label-warning{% endif %}
                            {% if ticket.priority == 'блокирующий' %}label-danger{% endif %}
                            ">
                        {{ ticket.priority }}
                        </span>
                    </td>
                    <td>{{ ticket.owner }}</td>
                    <td>{{ ticket.milestone }}</td>
                    <td>
                        <span class="
                            {% if ticket.status == 'closed' %}
                                label
                                {% if ticket.resolution == 'fixed' %}
                                    label-success
                                {% else %}
                                    label-default
                                {% endif %}
                            {% endif %}
                        ">
                            {{ ticket.status }}
                            {% if ticket.resolution %}- {{ ticket.resolution }}{% endif %}
                        </span>
                    </td>
                    <td>{{ ticket.keywords }}</td>
                </tr>
                {% if show_description %}
                    <tr>
                    <td colspan="2"></td>
                    <td colspan="8">{{ ticket.description }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
          </tbody>
      </table>
      </div>
{% if group_by_components or group_by_milestone%}
    </div>
{% endif %}
