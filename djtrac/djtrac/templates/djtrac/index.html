{% extends 'djtrac/base.html' %}

{% load staticfiles %}
{% load djtrac_tags %}

{% block extra_head %}
     <script type="text/javascript" src="{% static 'js/custom/index.js' %}"></script>
    {{ form.media }}
{% endblock %}

{% block body %}

        <form class="form-horizontal">
          <div class="row">
              <div class="col-sm-6">
                {% include "djtrac/form_templates/field.html" with field=form.component %}
                {% include "djtrac/form_templates/field.html" with field=form.milestone %}
                {% include "djtrac/form_templates/field.html" with field=form.number %}
              </div>
              <div class="col-sm-6">
                {% include "djtrac/form_templates/field.html" with field=form.keyword %}
                {% include "djtrac/form_templates/field.html" with field=form.dt_from %}
                {% include "djtrac/form_templates/field.html" with field=form.dt_to %}
              </div>
          </div>

          <div class="row">
              <div class="col-sm-2"></div>
              {% include "djtrac/form_templates/checkbox_field.html" with field=form.group_by_components %}
              {% include "djtrac/form_templates/checkbox_field.html" with field=form.group_by_milestone %}
              {% include "djtrac/form_templates/checkbox_field.html" with field=form.show_description %}
          </div>

          <div class="form-group">
                <div class="col-sm-2"></div>
                <div class="col-sm-10">
                  <button type="submit" class="btn btn-default btn-success">Показать</button>
                </div>
          </div>
        </form>

      {% if group_by_components and group_by_milestone %}
            {% for component, milestones in tickets_by_components.iteritems %}
                <div class="bs-callout bs-callout-info">
                    <h3 class="well">Направление: {{ component }}</h3>
                </div>
                {% for mitestone, page in milestones.iteritems %}
                    <h4>Этап: {{ mitestone|default:"не указан" }}</h4>
                    {% include 'djtrac/includes/page_tickets.html' %}
                {% endfor %}
            {% endfor %}


      {% elif group_by_components %}
          {% for component, page in tickets_by_components.iteritems %}
              {% include 'djtrac/includes/page_tickets.html' %}
          {% endfor %}
      {% else %}
          {% if page.object_list|length %}
            {% include 'djtrac/includes/page_tickets.html' %}

          {% else %}
              <div class="well">Ничего не найдено</div>
          {% endif %}

      {% endif %}



  {% endblock body %}
